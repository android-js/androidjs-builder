<html>

<head>
    <script src="./Vue/vue.js"></script>
    <!-- <script src="https://unpkg.com/axios/dist/axios.min.js"></script> -->
    <script src="./Vue/axios.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
        integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
        crossorigin="anonymous"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
        }
    </style>

</head>

<body>

    <div id="app">
        <!-- <pre>{{questions | pretty}}</pre> -->
        <!-- <li v-for="Q in (questions.data)" v-if="Q.type!='any'">
        {{ Q.question }}
    </li> -->

        <!--<tree-menu :nodes="tree.nodes" :depth="0" :label="tree.label"></tree-menu>-->
        <!---->
        <!-- <my-tree :nodes="questions.data" style="width: 30%"></my-tree> -->
        <side-bar fun="goo"></side-bar>
        <div class="container">
            {{formData}}
        </div>
    </div>


    <script type="text/x-template" id="my-tree">

    <ul class="my-tree list-group">
        <li v-for="n in nodes" class="list-group-item" style="border: none;border-bottom: 2px solid grey">
            <p @click="toggleChildren(n);openForm(n)">Q:({{n.id}}) {{ getText(n.question)}}</p>
            <my-tree v-if="show[n.id]" :nodes="n.children"></my-tree>
        </li>
    </ul>

</script>


    <script type="text/x-template" id="tree-menu">
    <div class="tree-menu">
        <div class="label-wrapper" @click="toggleChildren">
            <div :style="indent" :class="labelClasses">
                <i v-if="nodes" class="fa" :class="iconClasses"></i>{{ label }}
            </div>
        </div>
        <tree-menu
                v-if="showChildren"
                v-for="node in nodes"
                :nodes="node.nodes"
                :label="node.label"
                :depth="depth + 1"
        >
        </tree-menu>
    </div>
</script>

    <script type="text/x-template" id="side-bar">
    <div class = "info">
        <input type="text" @click="go()">
    </div>
</script>

    <script>
        var url = "/static/questions.json";
        let tree = {
            label: 'Question no one ? it contains sub-Questions',
            nodes: [
                {
                    label: 'Question no one ? sub q',
                    nodes: [
                        {
                            label: 'item1.1'
                        },
                        {
                            label: 'item1.2',
                            nodes: [
                                {
                                    label: 'item1.2.1'
                                }
                            ]
                        }
                    ]
                },
                {
                    label: 'item2'
                }
            ]
        }

        Vue.component('my-tree', {
            template: '#my-tree',
            props: ['nodes'],
            data() {
                return {
                    showChildren: false,
                    show: {}
                }
            },
            computed: {},
            methods: {
                toggleChildren(n) {
                    this.show[n.id] = !this.show[n.id];
                    console.log(n, this.show);
                    this.$forceUpdate();
                },
                getText(data) {
                    return data.length > 20 ? (data.slice(0, (data.length > 20) ? 20 : data.length) + "...") : data.slice(0, (data.length > 20) ? 20 : data.length);
                },
                openForm(data) {
                    this.formData = data;
                }
            }
        });

        Vue.component('tree-menu', {
            template: '#tree-menu',
            props: ['nodes', 'label', 'depth'],
            data() {
                return {
                    showChildren: false
                }
            },
            computed: {
                iconClasses() {
                    return {
                        'fa-plus-square-o': !this.showChildren,
                        'fa-minus-square-o': this.showChildren
                    }
                },
                labelClasses() {
                    return { 'has-children': this.nodes }
                },
                indent() {
                    return { transform: `translate(${this.depth * 50}px)` }
                }
            },
            methods: {
                toggleChildren() {
                    this.showChildren = !this.showChildren;
                }
            }
        });
        

        var app = new Vue({
            el: "#app",
            data: {
                questions: [],
                counter: 0,
                formData: "Form"

            },
            components: {
                'side-bar': {
                    template: '#side-bar',
                    props: ['fun'],
                    methods: {
                        go: () => {
                            console.log('goooo');
                            // this.$parent.goo();
                            console.log(this.fun)
                        }
                    }
                }
            },
            // data() {
            //     return {
            //         questions: [],
            //         counter: 0
            //     }
            // },
            mounted() {
                axios
                    .get(url)
                    .then(response => (this.questions = response.data))
            },
            methods: {
                goo: () => {
                    console.log('goooo');
                },
                closeTab(x) {
                    for (let i = 0; i < this.tabs.length; i++) {
                        if (this.questions[i].id === x) {
                            this.tabs.splice(i, 1)
                        }
                    }
                },
                newTab() {
                    let tab = {};
                    tab.id = this.tabCounter++;
                    this.tabs.push(tab)
                },

            }
        });
    </script>
</body>

</html>